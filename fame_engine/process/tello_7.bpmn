<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="sid-38422fae-e03e-43a3-bef4-bd33b32041b2" targetNamespace="http://bpmn.io/bpmn" exporter="bpmn-js-token-simulation" exporterVersion="0.1.5">
  <bpmn:process id="Process_1" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1y45yut" name="start">
      <bpmn:outgoing>Flow_12sodxw</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:scriptTask id="Activity_0q0spcq" name="takeoff" scriptFormat="JavaScript">
      <bpmn:incoming>Flow_060nm9x</bpmn:incoming>
      <bpmn:outgoing>Flow_1913056</bpmn:outgoing>
      <bpmn:script>
var node = this.environment.variables.ros_node;

const client = node.createClient("tello_msgs/srv/TelloAction", "tello_action");
const request = new Object();
request["cmd"] = "takeoff";

client.waitForService(1000).then((result) =&gt; {
    if (!result) {
        this.environment.services.console.log("Error: service not available");
        return;
    }
    this.environment.services.console.log("Sending: ", request);
    client.sendRequest(request, (response) =&gt; {
        this.environment.services.console.log("Result: ", response);
    });
});
this.environment.services.console.log("taking off");
next();</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:intermediateCatchEvent id="Event_1t9d9el">
      <bpmn:incoming>Flow_1913056</bpmn:incoming>
      <bpmn:outgoing>Flow_1j9fzsj</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0z0agyt">
        <bpmn:timeDuration xsi:type="tFormalExpression">PT10S</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:sequenceFlow id="Flow_1913056" sourceRef="Activity_0q0spcq" targetRef="Event_1t9d9el" />
    <bpmn:scriptTask id="Activity_00jigd3" name="land" scriptFormat="JavaScript">
      <bpmn:incoming>Flow_09p2rxv</bpmn:incoming>
      <bpmn:outgoing>Flow_17duhnu</bpmn:outgoing>
      <bpmn:script>
var node = this.environment.variables.ros_node;


const client = node.createClient("tello_msgs/srv/TelloAction", "tello_action");
const request = new Object();
request["cmd"] = "land";

client.waitForService(1000).then((result) =&gt; {
    if (!result) {
        this.environment.services.console.log("Error: service not available");
        return;
    }
    this.environment.services.console.log("Sending: ", request);
    client.sendRequest(request, (response) =&gt; {
        this.environment.services.console.log("Result: ", response);
    });
});
this.environment.services.console.log("landing");

next();</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:endEvent id="Event_09m97ox">
      <bpmn:incoming>Flow_17duhnu</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_17duhnu" sourceRef="Activity_00jigd3" targetRef="Event_09m97ox" />
    <bpmn:scriptTask id="Activity_0k7p4ui" name="init_tello" scriptFormat="JavaScript">
      <bpmn:incoming>Flow_12sodxw</bpmn:incoming>
      <bpmn:outgoing>Flow_060nm9x</bpmn:outgoing>
      <bpmn:script>
var node = this.environment.variables.ros_node;


next();</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_12sodxw" sourceRef="StartEvent_1y45yut" targetRef="Activity_0k7p4ui" />
    <bpmn:sequenceFlow id="Flow_060nm9x" sourceRef="Activity_0k7p4ui" targetRef="Activity_0q0spcq" />
    <bpmn:scriptTask id="Activity_1rq2z27" name="move" scriptFormat="JavaScript">
      <bpmn:incoming>Flow_1j9fzsj</bpmn:incoming>
      <bpmn:outgoing>Flow_1rxtjky</bpmn:outgoing>
      <bpmn:script>
var node = this.environment.variables.ros_node;
const publisher = node.createPublisher("geometry_msgs/msg/Twist", "cmd_vel");

publisher.publish({
    linear: {x: 0.0, y: 0.0, z: 0.0},
    angular: {x: 0.0, y: 0.0, z: 0.0}
});

this.environment.services.console.log("moving");
next();</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:intermediateCatchEvent id="Event_0zuhqq0">
      <bpmn:incoming>Flow_1rxtjky</bpmn:incoming>
      <bpmn:outgoing>Flow_09p2rxv</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0r92q2h">
        <bpmn:timeDuration xsi:type="tFormalExpression">PT10S</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:sequenceFlow id="Flow_1j9fzsj" sourceRef="Event_1t9d9el" targetRef="Activity_1rq2z27" />
    <bpmn:sequenceFlow id="Flow_1rxtjky" sourceRef="Activity_1rq2z27" targetRef="Event_0zuhqq0" />
    <bpmn:sequenceFlow id="Flow_09p2rxv" sourceRef="Event_0zuhqq0" targetRef="Activity_00jigd3" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BpmnDiagram_1">
    <bpmndi:BPMNPlane id="BpmnPlane_1" bpmnElement="Process_1">
      <bpmndi:BPMNShape id="StartEvent_1y45yut_di" bpmnElement="StartEvent_1y45yut">
        <omgdc:Bounds x="152" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="159" y="78" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0q0spcq_di" bpmnElement="Activity_0q0spcq">
        <omgdc:Bounds x="450" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1t9d9el_di" bpmnElement="Event_1t9d9el">
        <omgdc:Bounds x="602" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_12mkhs2" bpmnElement="Activity_0k7p4ui">
        <omgdc:Bounds x="280" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_174l3m4" bpmnElement="Activity_1rq2z27">
        <omgdc:Bounds x="680" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_09m97ox_di" bpmnElement="Event_09m97ox">
        <omgdc:Bounds x="1062" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_00jigd3_di" bpmnElement="Activity_00jigd3">
        <omgdc:Bounds x="910" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_10kg9y1" bpmnElement="Event_0zuhqq0">
        <omgdc:Bounds x="832" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_12sodxw_di" bpmnElement="Flow_12sodxw">
        <omgdi:waypoint x="188" y="120" />
        <omgdi:waypoint x="280" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1913056_di" bpmnElement="Flow_1913056">
        <omgdi:waypoint x="550" y="120" />
        <omgdi:waypoint x="602" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_060nm9x_di" bpmnElement="Flow_060nm9x">
        <omgdi:waypoint x="380" y="120" />
        <omgdi:waypoint x="450" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_17duhnu_di" bpmnElement="Flow_17duhnu">
        <omgdi:waypoint x="1010" y="120" />
        <omgdi:waypoint x="1062" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1j9fzsj_di" bpmnElement="Flow_1j9fzsj">
        <omgdi:waypoint x="638" y="120" />
        <omgdi:waypoint x="680" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1rxtjky_di" bpmnElement="Flow_1rxtjky">
        <omgdi:waypoint x="780" y="120" />
        <omgdi:waypoint x="832" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09p2rxv_di" bpmnElement="Flow_09p2rxv">
        <omgdi:waypoint x="868" y="120" />
        <omgdi:waypoint x="910" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>

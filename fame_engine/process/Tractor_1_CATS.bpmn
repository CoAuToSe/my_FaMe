<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1g2yzbf" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.11.1" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.15.0">
  <collaboration id="Collaboration_0deyc7u">
    <participant id="Participant_09245su" name="Tractor_1" processRef="Process_0lrm9nz" />
  </collaboration>
  <process id="Process_0lrm9nz" isExecutable="true">
    <laneSet id="LaneSet_0hdgryr">
      <lane id="Lane_0kluikv">
        <flowNodeRef>Event_tractor_1</flowNodeRef>
        <flowNodeRef>Gateway_1m0v088</flowNodeRef>
        <flowNodeRef>Gateway_1ta7lvc</flowNodeRef>
        <flowNodeRef>Event_closest_1</flowNodeRef>
        <flowNodeRef>Event_0s59drx</flowNodeRef>
        <flowNodeRef>Event_1gvpxlp</flowNodeRef>
        <flowNodeRef>Event_14h08iw</flowNodeRef>
        <flowNodeRef>Event_1l0dufn</flowNodeRef>
        <flowNodeRef>Activity_0hdy9li</flowNodeRef>
        <flowNodeRef>Activity_10iflt3</flowNodeRef>
        <flowNodeRef>Event_weed1</flowNodeRef>
        <flowNodeRef>Activity_1r1r1y9</flowNodeRef>
      </lane>
    </laneSet>
    <intermediateThrowEvent id="Event_tractor_1" name="tractor_position">
      <extensionElements>
        <property name="type" value="geometry_msgs/msg/Vector3Stamped" />
        <property name="payload" value="{&#34;header&#34;: {&#34;stamp&#34;: {&#34;sec&#34;: 0, &#34;nanosec&#34;: 100}, &#34;frame_id&#34;: &#34;tractor_1&#34;}, &#34;vector&#34;: {&#34;x&#34;: ${my_x}, &#34;y&#34;: ${my_y}, &#34;z&#34;: ${my_z}}}" />
      </extensionElements>
      <incoming>Flow_11eqadz</incoming>
      <outgoing>Flow_1lnhco2</outgoing>
      <signalEventDefinition id="SignalEventDefinition_0305jr8" signalRef="Signal_1s9llxt" />
    </intermediateThrowEvent>
    <eventBasedGateway id="Gateway_1m0v088">
      <incoming>Flow_1lnhco2</incoming>
      <outgoing>Flow_1m1x67e</outgoing>
      <outgoing>Flow_01lm9lo</outgoing>
    </eventBasedGateway>
    <exclusiveGateway id="Gateway_1ta7lvc" name="closest?">
      <incoming>Flow_101i6we</incoming>
      <outgoing>Flow_1w8fkqz</outgoing>
      <outgoing>Flow_0en0bg4</outgoing>
    </exclusiveGateway>
    <intermediateCatchEvent id="Event_closest_1" name="closest_tractor">
      <extensionElements>
        <properties>
          <property name="type" value="std_msgs/msg/String" />
        </properties>
      </extensionElements>
      <incoming>Flow_1m1x67e</incoming>
      <outgoing>Flow_101i6we</outgoing>
      <signalEventDefinition id="SignalEventDefinition_04hibg9" signalRef="Signal_1ocwgut" />
    </intermediateCatchEvent>
    <intermediateCatchEvent id="Event_0s59drx" name="30 sec.">
      <incoming>Flow_01lm9lo</incoming>
      <outgoing>Flow_0hqq4n4</outgoing>
      <timerEventDefinition id="TimerEventDefinition_0ybip03">
        <timeDuration xsi:type="tFormalExpression">PT30S</timeDuration>
      </timerEventDefinition>
    </intermediateCatchEvent>
    <dataObjectReference id="DataObject_weed" name="Weed Position" dataObjectRef="DataObject_1558mo1">
      <extensionElements>
        <properties>
          <property name="x_weed" value="${x_weed}" />
          <property name="y_weed" value="${y_weed}" />
        </properties>
      </extensionElements>
    </dataObjectReference>
    <dataObject id="DataObject_1558mo1" />
    <endEvent id="Event_1gvpxlp">
      <incoming>Flow_1w8fkqz</incoming>
    </endEvent>
    <endEvent id="Event_14h08iw">
      <incoming>Flow_0hqq4n4</incoming>
    </endEvent>
    <endEvent id="Event_1l0dufn">
      <incoming>Flow_0fzikdo</incoming>
    </endEvent>
    <callActivity id="Activity_0hdy9li" name="GoTo" calledElement="GoTo">
      <incoming>Flow_0en0bg4</incoming>
      <outgoing>Flow_1449dnp</outgoing>
      <property id="Property_16dj00z" name="__targetRef_placeholder" />
      <dataInputAssociation id="DataInputAssociation_1kcas6t">
        <sourceRef>DataObject_weed</sourceRef>
        <targetRef>Property_16dj00z</targetRef>
      </dataInputAssociation>
    </callActivity>
    <sequenceFlow id="Flow_0en0bg4" name="Yes" sourceRef="Gateway_1ta7lvc" targetRef="Activity_0hdy9li">
      <conditionExpression xsi:type="tFormalExpression" language="JavaScript">next(null, this.environment.variables.tractor === this.environment.variables.node.namespace().replace("/", ""));</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="Flow_1449dnp" sourceRef="Activity_0hdy9li" targetRef="Activity_1r1r1y9" />
    <sequenceFlow id="Flow_0fzikdo" sourceRef="Activity_1r1r1y9" targetRef="Event_1l0dufn" />
    <sequenceFlow id="Flow_1ax91m9" sourceRef="Event_weed1" targetRef="Activity_10iflt3" />
    <sequenceFlow id="Flow_1lnhco2" sourceRef="Event_tractor_1" targetRef="Gateway_1m0v088" />
    <sequenceFlow id="Flow_01lm9lo" sourceRef="Gateway_1m0v088" targetRef="Event_0s59drx" />
    <sequenceFlow id="Flow_1m1x67e" sourceRef="Gateway_1m0v088" targetRef="Event_closest_1" />
    <sequenceFlow id="Flow_101i6we" sourceRef="Event_closest_1" targetRef="Gateway_1ta7lvc" />
    <sequenceFlow id="Flow_1w8fkqz" name="No" sourceRef="Gateway_1ta7lvc" targetRef="Event_1gvpxlp">
      <conditionExpression xsi:type="tFormalExpression" language="JavaScript">next(null, this.environment.variables.tractor != this.environment.variables.node.namespace().replace("/", ""));</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="Flow_0hqq4n4" sourceRef="Event_0s59drx" targetRef="Event_14h08iw" />
    <sequenceFlow id="Flow_11eqadz" sourceRef="Activity_10iflt3" targetRef="Event_tractor_1" />
    <scriptTask id="Activity_10iflt3" name="Get Position" scriptFormat="JavaScript">
      <incoming>Flow_1ax91m9</incoming>
      <outgoing>Flow_11eqadz</outgoing>
      <script>const node_env = this.environment.variables;
      var node = node_env.ros_node;
      const subscriber = node.createSubscription("nav_msgs/msg/Odometry", "odom", (msg) =&gt; {
          this.environment.variables.my_x = msg.pose.pose.position.x;
          this.environment.variables.my_y = msg.pose.pose.position.y;
          this.environment.variables.my_z = msg.pose.pose.position.z;
          node.destroySubscription(subscriber);
      });

      next();
      </script>
    </scriptTask>
    <startEvent id="Event_weed1" name="weed_position">
      <extensionElements>
        <properties>
          <property name="type" value="geometry_msgs/msg/Vector3" />
        </properties>
      </extensionElements>
      <outgoing>Flow_1ax91m9</outgoing>
      <dataOutputAssociation id="DataOutputAssociation_0ceooe9">
        <targetRef>DataObject_weed</targetRef>
      </dataOutputAssociation>
      <signalEventDefinition id="SignalEventDefinition_0e2d536" signalRef="Signal_0h8bxp7" />
    </startEvent>
    <scriptTask id="Activity_1r1r1y9" name="Cut grass" scriptFormat="JavaScript">
      <incoming>Flow_1449dnp</incoming>
      <outgoing>Flow_0fzikdo</outgoing>
      <script>const node = this.environment.variables.ros_node;
      const publisher = node.createPublisher("geometry_msgs/msg/Wrench", "blade_force");
      publisher.publish({
      force: {x: 0.0, y: 0.0, z: 0.0},
      torque: {x: 0.0, y: 0.0, z: 1.0}
      });
      next();
      </script>
    </scriptTask>
  </process>
  <signal id="Signal_0h8bxp7" name="weed_position" />
  <signal id="Signal_1s9llxt" name="tractor_position" />
  <signal id="Signal_1ocwgut" name="closest_tractor" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0deyc7u">
      <bpmndi:BPMNShape id="Participant_09245su_di" bpmnElement="Participant_09245su" isHorizontal="true">
        <dc:Bounds x="180" y="80" width="980" height="285" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0kluikv_di" bpmnElement="Lane_0kluikv" isHorizontal="true">
        <dc:Bounds x="210" y="80" width="950" height="285" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_11eqadz_di" bpmnElement="Flow_11eqadz">
        <di:waypoint x="440" y="244" />
        <di:waypoint x="492" y="244" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hqq4n4_di" bpmnElement="Flow_0hqq4n4">
        <di:waypoint x="658" y="304" />
        <di:waypoint x="752" y="304" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1w8fkqz_di" bpmnElement="Flow_1w8fkqz">
        <di:waypoint x="720" y="187" />
        <di:waypoint x="720" y="224" />
        <di:waypoint x="752" y="224" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="724" y="233" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_101i6we_di" bpmnElement="Flow_101i6we">
        <di:waypoint x="658" y="162" />
        <di:waypoint x="695" y="162" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1m1x67e_di" bpmnElement="Flow_1m1x67e">
        <di:waypoint x="575" y="219" />
        <di:waypoint x="575" y="162" />
        <di:waypoint x="622" y="162" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_01lm9lo_di" bpmnElement="Flow_01lm9lo">
        <di:waypoint x="575" y="269" />
        <di:waypoint x="575" y="304" />
        <di:waypoint x="622" y="304" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1lnhco2_di" bpmnElement="Flow_1lnhco2">
        <di:waypoint x="528" y="244" />
        <di:waypoint x="550" y="244" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ax91m9_di" bpmnElement="Flow_1ax91m9">
        <di:waypoint x="298" y="244" />
        <di:waypoint x="340" y="244" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fzikdo_di" bpmnElement="Flow_0fzikdo">
        <di:waypoint x="1050" y="162" />
        <di:waypoint x="1082" y="162" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1449dnp_di" bpmnElement="Flow_1449dnp">
        <di:waypoint x="920" y="162" />
        <di:waypoint x="950" y="162" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0en0bg4_di" bpmnElement="Flow_0en0bg4">
        <di:waypoint x="745" y="162" />
        <di:waypoint x="820" y="162" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="755" y="144" width="19" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_1g40h4b_di" bpmnElement="Event_tractor_1">
        <dc:Bounds x="492" y="226" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="473" y="269" width="76" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1m0v088_di" bpmnElement="Gateway_1m0v088">
        <dc:Bounds x="550" y="219" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1ta7lvc_di" bpmnElement="Gateway_1ta7lvc" isMarkerVisible="true">
        <dc:Bounds x="695" y="137" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="670" y="120" width="41" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_090nvsi_di" bpmnElement="Event_closest_1">
        <dc:Bounds x="622" y="144" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="605" y="187" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0s59drx_di" bpmnElement="Event_0s59drx">
        <dc:Bounds x="622" y="286" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="622" y="329" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataObjectReference_0lq73uw_di" bpmnElement="DataObject_weed">
        <dc:Bounds x="492" y="128" width="36" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="476" y="185" width="71" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1gvpxlp_di" bpmnElement="Event_1gvpxlp">
        <dc:Bounds x="752" y="206" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_14h08iw_di" bpmnElement="Event_14h08iw">
        <dc:Bounds x="752" y="286" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1l0dufn_di" bpmnElement="Event_1l0dufn">
        <dc:Bounds x="1082" y="144" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0hdy9li_di" bpmnElement="Activity_0hdy9li">
        <dc:Bounds x="820" y="122" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_10iflt3_di" bpmnElement="Activity_10iflt3">
        <dc:Bounds x="340" y="204" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1gfoldl_di" bpmnElement="Event_weed1">
        <dc:Bounds x="262" y="226" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="246" y="269" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1te5qr6_di" bpmnElement="Activity_1r1r1y9">
        <dc:Bounds x="950" y="122" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataInputAssociation_1kcas6t_di" bpmnElement="DataInputAssociation_1kcas6t">
        <di:waypoint x="510" y="128" />
        <di:waypoint x="510" y="103" />
        <di:waypoint x="860" y="103" />
        <di:waypoint x="860" y="122" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_0ceooe9_di" bpmnElement="DataOutputAssociation_0ceooe9">
        <di:waypoint x="280" y="226" />
        <di:waypoint x="280" y="153" />
        <di:waypoint x="492" y="153" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
